<div class="row">
    <div class="col-md-12">
        <div class="box">
            <div class="box-body">
                <form class="form-inline" name="searchForm"  method="GET">
                    <div class="form-group">
                        <select name="gid" id="gid" class="form-control">
                            <option value="">请选择...</option>
                            {volist name='goodes' id='vv'}
                            <option value="{$vv.id}" {if condition="$Think.get.gid eq $vv.id"}selected="" {/if} >{$vv.title}</option>
                            {/volist}
                        </select>
                    </div>

                    <div class="form-group">
                        <select name="paytype" id="paytype" class="form-control">
                            <option value="">请选择...</option>

                            <option value="1" {if condition="$Think.get.paytype eq 1" } selected="" {/if}>支付宝</option>
                            <option value="2" {if condition="$Think.get.paytype eq 2" } selected="" {/if}>微信</option>
                            <option value="3" {if condition="$Think.get.paytype eq 3" } selected="" {/if}>qq支付</option>

                        </select>
                    </div>

                    <div class="form-group">
                        <button data-href="{:url('order/person')}"  class="btn btn-sm btn-primary search" type="button">
                            <i class="fa fa-search"></i> 查询
                        </button>
                    </div>

                    <div class="form-group">
                        <button onclick="clear_form()" class="btn btn-sm btn-" type="button"><i
                                class="fa  fa-eraser"></i> 清空查询
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="box">

            <div class="box-body table-responsive">

                <div class="form-group">
                    <button onclick="clear_form()" class="btn btn-info pull-right" type="button"><i
                            class="fa  fa-eraser"></i> 删除未完成订单
                    </button>
                </div>

                <table class="table table-hover table-bordered datatable" width="100%">
                    <thead>
                    <tr>
                        <th>订单号</th>
                        <th>商品名称</th>
                        <th>数量</th>
                        <th>账号</th>
                        <th>价格</th>
                        <th>支付方式</th>
                        <th>状态</th>
                        <th>发货方式</th>
                        <th>联系方式</th>
                        <th>创建时间</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    {volist name='list' id='vo'}
                    <tbody>
                    <tr>
                        <td>{$vo.order_no}</td>
                        <td>{$goods[$vo.gid]}</td>
                        <td>{$vo.num}</td>
                        <td>
                            {empty name='$vo.member_id'}
                                 游客
                            {else /}
                            {$info[$vo.member_id]}
                            {/empty}
                        </td>
                        <td>{$vo.countpay}</td>
                        <td>
                            {switch name="vo.paytype"}
                            {case value="1"}支付宝支付{/case}
                            {case value="2"}微信支付{/case}
                            {case value="3"}QQ支付{/case}
                            {case value="4"}余额支付{/case}
                            {default /}
                             <span class="btn btn-danger btn-xs">未支付</span>
                            {/switch}
                        </td>
                        <td>
                            {switch name="vo.status"}
                            {case value="1"}
                            <a class="btn btn-block btn-success btn-xs">已支付</a>
                            {/case}
                            {case value="2"}
                            <a class="btn btn-block btn-linkedin btn-xs">已发货</a>
                            {/case}
                            {case value="3"}
                            <a class="btn btn-block btn-foursquare btn-xs">联系客服退款</a>
                            {/case}
                            {default /}
                            <a class="btn btn-block btn-primary btn-xs">未支付</a>
                            {/switch}
                        </td>
                        <td>
                            {eq name='$vo.huo' value='0'}
                            <a class="btn btn-block btn-flickr btn-xs">自动发货</a>
                            {else /}
                            <a class="btn btn-block btn-github btn-xs">手动发货</a>
                            {/eq}
                        </td>
                        <td>{$vo.mobile}</td>
                        <td>{$vo.create_time}</td>
                        <td class="td-do">
                            <a href="edit.html" class="btn btn-success btn-xs" title="修改">
                                <i class="fa fa-pencil">补单</i>
                            </a>
                            <a  data-href="{:url('order/pedit',array('id'=>$vo.id))}" class="btn btn-primary btn-xs pedit" title="修改">
                                <i class="fa fa-pencil">编辑订单</i>
                            </a>
                            <a class="btn btn-danger btn-xs del" title="删除" data-id="" data-href="{:url('order/pdel',array('id'=>$vo.id))}">
                                <i class="fa fa-trash">删除</i>
                            </a>
                        </td>
                    </tr>
                    </tbody>
                    {/volist}

                </table>
            </div>
        </div>
        {$list->render();}

        <script>
            $('.pedit').click(function(){
                var url = $(this).attr('data-href');
                layer.open({
                        type: 2,
                        title: '编辑订单',
                        shadeClose: true,
                        shade: false,
                        area: ['60%', '70%'],
                        content: url,
                    })
            });

            //删除
            $('.del').click(function(){
               var url = $(this).attr('data-href');
               layer.confirm('您确定删除？',
                   {btn:['确定','取消']},
                    function(){
                       $.get(url,function(ret){
                           if(ret.code ==200){
                             layer.msg(ret.msg,function(){
                                 parent.location.reload();
                             })
                           }
                           if(ret.code == 400){
                             layer.msg(ret.msg,function(){
                                 parent.location.reload();
                             })
                           }
                       })
                    },
                   function(){
                    parent.layer.close();
                   }
               )
            });

            $('.search').click(function(){
                var url     = $(this).attr('data-href');
                var gid     = $('#gid option:selected').val();
                var paytype = $('#paytype option:selected').val();

                if(gid ==  '' || gid==undefined){
                    layer.msg('请选择商品');
                    return ;
                }

                if(paytype ==  '' || paytype==undefined){
                    layer.msg('请选择支付类型');
                    return ;
                }

                location.href= url+"?gid="+gid+"&paytype="+paytype;

            })
        </script>